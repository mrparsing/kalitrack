<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recupera Password - KaliTrack</title>
    <link rel="stylesheet" href="../home/style_home.css">
    <link rel="stylesheet" href="style_recupera_password.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase SDK -->
    <script type="module">
        // Import necessary Firebase functions
        // Import necessary Firebase functions
        import { sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // Add the DOMContentLoaded event listener
        window.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('.recovery-form');
            form.addEventListener('submit', handlePasswordReset);
        });

        // Function to handle password reset
        function handlePasswordReset(event) {
            event.preventDefault(); // Prevent default form submission

            const email = document.getElementById('email').value;
            const loader = document.getElementById('loader');
            loader.style.display = 'block';

            // Use Firebase Authentication to send a password reset email
            sendPasswordResetEmail(auth, email)
                .then(() => {
                    loader.style.display = 'none'; // Hide loader
                    showNotification("Email di recupero inviata con successo!", "green");
                })
                .catch((error) => {
                    loader.style.display = 'none'; // Hide loader

                    // Handle different error scenarios
                    switch (error.code) {
                        case 'auth/user-not-found':
                            showNotification("Indirizzo email non trovato.", "red");
                            break;
                        case 'auth/invalid-email':
                            showNotification("Indirizzo email non valido.", "red");
                            break;
                        case 'auth/network-request-failed':
                            showNotification("Errore di rete. Controlla la tua connessione.", "red");
                            break;
                        default:
                            showNotification("Errore durante l'invio dell'email.", "red");
                            break;
                    }

                    console.error("Errore:", error);
                });
        }

        // Function to show a notification

    </script>
</head>

<body>
    <header>
        <div class="logo">KaliTrack</div>
    </header>

    <div class="login-container">
        <h2>Recupera password</h2>
        <form class="recovery-form">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Inserisci la tua email" required>
            <button type="submit" class="login-btn">Invia email di recupero</button>
            <div class="loader" id="loader" style="display: none;"></div>
        </form>
        <div class="back-to-login">
            <a href="../login/login.html"><i class="fas fa-arrow-left"></i> Torna al Login</a>
        </div>
    </div>
</body>

</html>