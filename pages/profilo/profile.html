<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profilo</title>
    <link rel="stylesheet" type="text/css" href="../home/style_home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // Configurazione di Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB2qNYCMQMjm6pAqTEWvP-1FWfPfKaQCi8",
            authDomain: "kalitrack.firebaseapp.com",
            projectId: "kalitrack",
            storageBucket: "kalitrack.appspot.com",
            messagingSenderId: "253824979149",
            appId: "1:253824979149:web:21f3085e86bb3a41821984",
            measurementId: "G-498X9RNHLC"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();

        // Funzione per caricare le informazioni del profilo
        function loadProfile(user) {
            if (!user) {
                console.log("Utente non autenticato.");
                return;
            }

            const userDocRef = doc(db, "userProfiles", user.uid);
            console.log(user.uid);

            getDoc(userDocRef)
                .then((doc) => {
                    if (doc.exists()) {
                        const userData = doc.data();
                        document.getElementById("name").innerText = userData.name || "Non disponibile";
                        document.getElementById("email").innerText = userData.email || "Non disponibile";
                        document.getElementById("age").innerText = userData.age || "Non disponibile";
                        document.getElementById("gender").innerText = userData.gender || "Non disponibile";
                        document.getElementById("weight").innerText = userData.weight || "Non disponibile";
                    } else {
                        console.log("Nessun documento trovato!");
                    }
                })
                .catch((error) => {
                    console.error("Errore nel recupero del documento:", error);
                });
        }

        // Chiama la funzione per caricare il profilo quando l'utente è autenticato
        onAuthStateChanged(auth, (user) => {
            loadProfile(user);
        });
    </script>
</head>

<body>
    <!-- Header -->
    <header>
        <button class="menu-btn" id="menuButton" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="logo">Profilo</div>
    </header>

    <div class="dashboard-container">
        <!-- Sidebar with Buttons -->
        <aside class="sidebar">
            <a href="../home/home.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-home"></i>
                </span>
                <span class="text">Dashboard</span>
            </a>

            <a href="../sessioni_successive/sessioni_successive.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-calendar-alt"></i>
                </span>
                <span class="text">Sessioni future</span>
            </a>

            <a href="../storico_sessioni/storico_sessioni.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-history"></i>
                </span>
                <span class="text">Storico Sessioni</span>
            </a>

            <a href="aggiungi_sessione.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-plus"></i>
                </span>
                <span class="text">Aggiungi sessioni</span>
            </a>

            <a href="../massimali/massimali.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-dumbbell"></i>
                </span>
                <span class="text">Massimali</span>
            </a>

            <a href="../sfide/sfide.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-trophy"></i>
                </span>
                <span class="text">Sfide</span>
            </a>

            <!-- Divider -->
            <div class="sidebar-divider"></div>

            <!-- Profile, Settings, and Logout Buttons -->
            <a href="profile.html" class="sidebar-btn">
                <span class="icon-container">
                    <i class="fas fa-user-circle"></i>
                </span>
                <span class="text">Profilo</span>
            </a>

            <button class="sidebar-btn">
                <i class="fas fa-cog"></i>
                <span>Impostazioni</span>
            </button>

            <button class="sidebar-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <section class="profile-section" id="profile-section">
                <h2>Profilo Utente</h2>
                <div id="profile-info">
                    <p><strong>Nome:</strong> <span id="name">Caricamento...</span></p>
                    <p><strong>Email:</strong> <span id="email">Caricamento...</span></p>
                    <p><strong>Età:</strong> <span id="age">Caricamento...</span></p>
                    <p><strong>Sesso:</strong> <span id="gender">Caricamento...</span></p>
                    <p><strong>Peso:</strong> <span id="weight">Caricamento...</span></p>
                </div>
                <button class="sidebar-btn" onclick="editProfile()">Modifica Profilo</button>
            </section>
        </main>
    </div>

    <div class="overlay" id="overlay"></div>

    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('overlay');
            const menuButton = document.getElementById('menuButton');

            sidebar.classList.toggle('active');
            overlay.classList.toggle('visible');

            if (sidebar.classList.contains('active')) {
                menuButton.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                menuButton.innerHTML = '<i class="fas fa-bars"></i>';
            }
        }

        document.getElementById('overlay').addEventListener('click', () => {
            toggleSidebar();
        });

        async function logout() {
            try {
                await auth.signOut();
                alert("Logout effettuato con successo!");
                window.location.href = "../../index.html";
            } catch (error) {
                console.error("Errore durante il logout:", error);
                alert("Si è verificato un errore durante il logout.");
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', logout);

    </script>
</body>

</html>